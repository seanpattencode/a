version: '3.8'

services:
  orchestrator:
    build: .
    container_name: aios-orchestrator
    volumes:
      # Mount directories for persistence
      - ./Common:/app/Common
      - ./Programs:/app/Programs
      - ./orchestrator.py:/app/orchestrator.py:ro
    environment:
      - DEVICE_ID=docker-main
      - DEVICE_TAGS=gpu,storage,browser
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - aios-network

  # Test container with different tags
  orchestrator-test:
    build: .
    container_name: aios-orchestrator-test
    volumes:
      - ./Common:/app/Common
      - ./Programs:/app/Programs
      - ./orchestrator.py:/app/orchestrator.py:ro
    environment:
      - DEVICE_ID=docker-test
      - DEVICE_TAGS=test
      - PYTHONUNBUFFERED=1
    command: python orchestrator.py --test
    networks:
      - aios-network

networks:
  aios-network:
    driver: bridge